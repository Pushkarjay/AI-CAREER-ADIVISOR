rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow authenticated users to read/write their own user data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow authenticated users to read/write their own profiles
    match /profiles/{profileId} {
      allow read, write: if request.auth != null && request.auth.uid == profileId;
    }
    
    // Allow authenticated users to read career data (public but requires auth)
    match /careers/{document=**} {
      allow read: if request.auth != null;
      allow write: if false; // Only backend should write career data
    }
    
    // Allow authenticated users to read/write their chat sessions
    match /chat_sessions/{sessionId} {
      allow read, write: if request.auth != null && 
        (request.auth.uid == resource.data.user_id || request.auth.uid == request.resource.data.user_id);
    }
    
    // Allow authenticated users to access analytics (read-only)
    match /analytics/{document=**} {
      allow read: if request.auth != null;
      allow write: if false; // Only backend analytics service should write
    }
    
    // Allow users to read/write their skill assessments
    match /skill_assessments/{assessmentId} {
      allow read, write: if request.auth != null && 
        (request.auth.uid == resource.data.user_id || request.auth.uid == request.resource.data.user_id);
    }
    
    // Allow users to read/write their job matches
    match /job_matches/{matchId} {
      allow read, write: if request.auth != null && 
        (request.auth.uid == resource.data.user_id || request.auth.uid == request.resource.data.user_id);
    }
  }
}